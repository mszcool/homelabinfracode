config:
  core.https_address: 127.0.0.1:9443
  images.auto_update_interval: 15

networks:
- name: incus-prod-bridge
  type: macvlan
  config:
    parent: {{ tp_incus_netconfig.physical_network_parent }}
- name: incus-lab-nat
  type: bridge
  config:
    ipv4.address: 10.100.0.1/24
    ipv4.dhcp: true
    ipv4.nat: true
    ipv6.address: none
    ipv6.nat: false

storage_pools:
- name: incus-images
  driver: lvm
  config:
    source: {{ tp_incus_config.storage_images.volume_group }}
    lvm.use_thinpool: true
    lvm.vg.force_reuse: true
    lvm.thinpool_name: {{ tp_incus_config.storage_images.volume }}
- name: incus-instances
  driver: lvm
  config:
    source: {{ tp_incus_config.storage_instances.volume_group }}
    lvm.use_thinpool: true
    lvm.vg.force_reuse: true
    lvm.thinpool_name: {{ tp_incus_config.storage_instances.volume }}

projects:
- name: default
  config:
    features.images: true
    features.networks: true
    features.profiles: true
    features.storage.volumes: true
    limits.disk: 350GB
  description: Default Lab VMs with NAT networking and storage limits

profiles:
- name: default
  description: "Default profile for VMs with NAT networking and {{ tp_incus_config.profile_disk_sizes.default }} root disk"
  devices:
    root:
      path: /
      pool: incus-instances
      type: disk
      size: {{ tp_incus_config.profile_disk_sizes.default }}
    eth0:
      name: eth0
      network: incus-lab-nat
      type: nic
  config:
    boot.autostart: false
    security.privileged: false
- name: production
  description: "Profile for production VMs with bridged networking and {{ tp_incus_config.profile_disk_sizes.production }} root disk"
  devices:
    root:
      path: /
      pool: incus-instances
      type: disk
      size: {{ tp_incus_config.profile_disk_sizes.production }}
    eth0:
      name: eth0
      network: incus-prod-bridge
      type: nic
  config:
    boot.autostart: true
    security.privileged: false
    security.protection.delete: false
